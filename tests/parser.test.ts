import { parse } from '../src/starlark-parser';

var assert = require('assert');

const correct = String.raw`{"Path":"/home/kumiko/starlark-ts/tests/example.star","Stmts":[{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":2,"col":8},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":2,"col":1},"Name":"number","Binding":null},"RHS":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":2,"col":10},"raw":"18","value":18}},{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":5,"col":8},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":5,"col":1},"Name":"people","Binding":null},"RHS":{"commentsRef":{"ref":null},"Lbrace":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":5,"col":10},"List":[{"commentsRef":{"ref":null},"Key":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":6,"col":5},"raw":"\",A,l,i,c,e,\"","value":"\",A,l,i,c,e,\""},"Colon":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":6,"col":12},"Value":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":6,"col":14},"raw":"22","value":22}},{"commentsRef":{"ref":null},"Key":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":7,"col":5},"raw":"\",B,o,b,\"","value":"\",B,o,b,\""},"Colon":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":7,"col":10},"Value":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":7,"col":12},"raw":"40","value":40}},{"commentsRef":{"ref":null},"Key":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":8,"col":5},"raw":"\",C,h,a,r,l,i,e,\"","value":"\",C,h,a,r,l,i,e,\""},"Colon":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":8,"col":14},"Value":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":8,"col":16},"raw":"55","value":55}},{"commentsRef":{"ref":null},"Key":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":9,"col":5},"raw":"\",D,a,v,e,\"","value":"\",D,a,v,e,\""},"Colon":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":9,"col":11},"Value":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":9,"col":13},"raw":"14","value":14}}],"Rbrace":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":10,"col":1}}},{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":7},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":1},"Name":"names","Binding":null},"RHS":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":9},"raw":"\",,, ,\"","value":"\",,, ,\""},"Dot":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":13},"NamePos":null,"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":14},"Name":"join","Binding":null}},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":18},"Args":[{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":19},"Name":"people","Binding":null},"Dot":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":25},"NamePos":null,"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":26},"Name":"keys","Binding":null}},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":30},"Args":[],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":31}}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":12,"col":32}}},{"commentsRef":{"ref":null},"Def":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":15,"col":1},"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":15,"col":5},"Name":"greet","Binding":null},"Params":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":15,"col":11},"Name":"name","Binding":null}],"Body":[{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":16,"col":5},"raw":"\",\",\",R,e,t,u,r,n, ,a, ,g,r,e,e,t,i,n,g,.,\",\",\"","value":"\",\",\",R,e,t,u,r,n, ,a, ,g,r,e,e,t,i,n,g,.,\",\",\""}},{"commentsRef":{"ref":null},"Return":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":5},"Result":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":12},"raw":"\",H,e,l,l,o, ,{,},!,\"","value":"\",H,e,l,l,o, ,{,},!,\""},"Dot":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":23},"NamePos":null,"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":24},"Name":"format","Binding":null}},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":30},"Args":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":31},"Name":"name","Binding":null}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":17,"col":35}}}]},{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":10},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":1},"Name":"greeting","Binding":null},"RHS":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":12},"Name":"greet","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":17},"Args":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":18},"Name":"names","Binding":null}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":19,"col":23}}},{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":9},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":1},"Name":"above30","Binding":null},"RHS":{"commentsRef":{"ref":null},"Curly":false,"Lbrack":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":11},"Body":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":12},"Name":"name","Binding":null},"Clauses":[{"commentsRef":{"ref":null},"forPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":17},"vars":{"commentsRef":{"ref":null},"Lparen":null,"List":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":21},"Name":"name","Binding":null},{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":27},"Name":"age","Binding":null}],"Rparen":null},"inPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":31},"x":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":34},"Name":"people","Binding":null},"Dot":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":40},"NamePos":null,"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":41},"Name":"items","Binding":null}},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":46},"Args":[],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":47}}},{"commentsRef":{"ref":null},"If":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":49},"Cond":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":52},"Name":"age","Binding":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":56},"Op":">=","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":59},"raw":"30","value":30}}}],"Rbrack":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":21,"col":61}}},{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":1},"Name":"print","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":6},"Args":[{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":7},"raw":"\",{,}, ,p,e,o,p,l,e, ,a,r,e, ,a,b,o,v,e, ,3,0,.,\"","value":"\",{,}, ,p,e,o,p,l,e, ,a,r,e, ,a,b,o,v,e, ,3,0,.,\""},"Dot":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":32},"NamePos":null,"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":33},"Name":"format","Binding":null}},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":39},"Args":[{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":40},"Name":"len","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":43},"Args":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":44},"Name":"above30","Binding":null}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":51}}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":52}}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":23,"col":53}}},{"commentsRef":{"ref":null},"Def":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":25,"col":1},"Name":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":25,"col":5},"Name":"fizz_buzz","Binding":null},"Params":[{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":25,"col":15},"Name":"n","Binding":null}],"Body":[{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":26,"col":5},"raw":"\",\",\",P,r,i,n,t, ,F,i,z,z, ,B,u,z,z, ,n,u,m,b,e,r,s, ,f,r,o,m, ,1, ,t,o, ,n,.,\",\",\"","value":"\",\",\",P,r,i,n,t, ,F,i,z,z, ,B,u,z,z, ,n,u,m,b,e,r,s, ,f,r,o,m, ,1, ,t,o, ,n,.,\",\",\""}},{"commentsRef":{"ref":null},"For":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":5},"Vars":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":9},"Name":"i","Binding":null},"X":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":14},"Name":"range","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":19},"Args":[{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":20},"raw":"1","value":1},{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":23},"Name":"n","Binding":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":25},"Op":"+","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":27},"raw":"1","value":1}}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":27,"col":28}},"Body":[{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":28,"col":11},"Op":"=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":28,"col":9},"Name":"s","Binding":null},"RHS":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":28,"col":13},"raw":"\",\"","value":"\",\""}},{"commentsRef":{"ref":null},"ifPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":9},"cond":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":12},"Name":"i","Binding":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":14},"Op":"%","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":16},"raw":"3","value":3}},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":18},"Op":"==","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":29,"col":21},"raw":"0","value":0}},"trueBody":[{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":30,"col":15},"Op":"+=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":30,"col":13},"Name":"s","Binding":null},"RHS":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":30,"col":18},"raw":"\",F,i,z,z,\"","value":"\",F,i,z,z,\""}}],"elsePos":null,"falseBody":[]},{"commentsRef":{"ref":null},"ifPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":9},"cond":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":12},"Name":"i","Binding":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":14},"Op":"%","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":16},"raw":"5","value":5}},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":18},"Op":"==","Y":{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":31,"col":21},"raw":"0","value":0}},"trueBody":[{"commentsRef":{"ref":null},"OpPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":32,"col":15},"Op":"+=","LHS":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":32,"col":13},"Name":"s","Binding":null},"RHS":{"commentsRef":{"ref":null},"token":"string literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":32,"col":18},"raw":"\",B,u,z,z,\"","value":"\",B,u,z,z,\""}}],"elsePos":null,"falseBody":[]},{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":9},"Name":"print","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":14},"Args":[{"commentsRef":{"ref":null},"If":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":17},"Cond":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":20},"Name":"s","Binding":null},"True":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":15},"Name":"s","Binding":null},"ElsePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":22},"False":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":27},"Name":"i","Binding":null}}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":33,"col":28}}}]}]},{"commentsRef":{"ref":null},"X":{"commentsRef":{"ref":null},"Fn":{"commentsRef":{"ref":null},"NamePos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":35,"col":1},"Name":"fizz_buzz","Binding":null},"Lparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":35,"col":10},"Args":[{"commentsRef":{"ref":null},"token":"int literal","tokenPos":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":35,"col":11},"raw":"20","value":20}],"Rparen":{"file":"/home/kumiko/starlark-ts/tests/example.star","line":35,"col":13}}}],"Module":null}`;

describe('test parser', function () {
  const path = require('path');
  const fs = require('fs');

  const basedir = __dirname;
  const file = basedir + '/example.star';

  describe('parse ' + file, function () {
    it('parse successfully', function () {
      let [rs, err] = parse(file, null, 0);
      assert.equal(err, null);
      assert.equal(JSON.stringify(rs), correct);
    });
  });
});
